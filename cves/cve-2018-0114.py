import base64
from Crypto.Signature import PKCS1_v1_5
from Crypto import Random
from Crypto.PublicKey import RSA
from Crypto.Hash import SHA256

def to_bytes(n):
	h = '%x' % n
	s = ('0' * (len(h) % 2) + h).decode('hex')
	return s

private_key = RSA.generate(1024, Random.new().read)
public_key = private_key.publickey()

n = base64.urlsafe_b64encode(to_bytes(public_key.n))
e = base64.urlsafe_b64encode(to_bytes(public_key.e))

payload = 'YOUR_PAYLOAD'
headers = ('{'
                '"alg":"RS256",'
                '"jwk": {'
                    '"kty": "RSA",'
                    '"kid": "matan@h.com",'
                    '"use": "sig",'
                    '"n":"' + n + '",'
                    '"e":"' + e + '"'
                '}'
            '}')

b64Headers = base64.b64encode(headers).replace('=', '')
b64payload = base64.b64encode(payload).replace('=', '')
b64HeadersAndPayload = b64Headers + '.' + b64payload

signer = PKCS1_v1_5.new(private_key)
digest = SHA256.new()
digest.update(b64HeadersAndPayload)
signature = base64.b64encode(signer.sign(digest))

token = b64HeadersAndPayload + '.' + signature
print token